import streamlit as st
import ee
import geemap.foliumap as geemap
import pandas as pd
import datetime

# ---------------------------
# Inicializar Earth Engine
# ---------------------------
try:
    ee.Initialize()
except Exception as e:
    ee.Authenticate()
    ee.Initialize()

# ---------------------------
# Configura칞칫es da p치gina
# ---------------------------
st.set_page_config(layout="wide")
st.title("游깴 Monitoramento da Qualidade do Ar - Hortol칙ndia")

# ---------------------------
# Sele칞칚o de par칙metros
# ---------------------------
st.sidebar.header("Par칙metros")

start_date = st.sidebar.date_input("Data in칤cio", value=datetime.date(2025, 9, 1))
end_date = st.sidebar.date_input("Data fim", value=datetime.date(2025, 9, 5))

sd = pd.to_datetime(start_date).strftime("%Y-%m-%d")
ed = pd.to_datetime(end_date).strftime("%Y-%m-%d")

pollutant = st.sidebar.selectbox(
    "Selecione o poluente",
    ["NO2", "O3", "CO"]
)

# ---------------------------
# Coordenadas de Hortol칙ndia
# ---------------------------
roi = ee.Geometry.Point([-47.2191, -22.8583]).buffer(20000)  # 20 km

# ---------------------------
# Sele칞칚o de cole칞칚o Sentinel-5P
# ---------------------------
collections = {
    "NO2": "COPERNICUS/S5P/OFFL/L3_NO2",
    "O3": "COPERNICUS/S5P/OFFL/L3_O3",
    "CO": "COPERNICUS/S5P/OFFL/L3_CO"
}

band_map = {
    "NO2": "NO2_column_number_density",
    "O3": "O3_column_number_density",
    "CO": "CO_column_number_density"
}

col = ee.ImageCollection(collections[pollutant]).select(band_map[p]()_

